<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Zeiterfassung</title>

<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="Zeiterfassung" />
<meta name="theme-color" content="#0b1220" />
<meta name="robots" content="noindex,nofollow" />

<link id="appleIcon" rel="apple-touch-icon" href="">
<link id="faviconIcon" rel="icon" href="">

<style>
:root{
  --bg:#f4f6f8; --card:#fff; --text:#0f172a; --muted:#64748b;
  --line:#e5e7eb;
  --ok:#166534; --okbg:#dcfce7;
  --warn:#9a3412; --warnbg:#fff7ed;
  --primary:#2563eb;
  --shadow:0 2px 12px rgba(0,0,0,.08);
  --chip:#eef2ff;
}
*{box-sizing:border-box}
body{margin:0;padding:14px;font-family:-apple-system,system-ui;background:var(--bg);color:var(--text)}
.card{background:var(--card);border-radius:16px;padding:14px;margin-bottom:14px;box-shadow:var(--shadow)}
h1{margin:0 0 6px 0;font-size:20px}
h2{margin:10px 0 10px 0;font-size:16px}
.muted{color:var(--muted);font-size:13px}
.mono{font-family:ui-monospace,Menlo,monospace}

.row{display:flex;flex-wrap:wrap;align-items:flex-end;column-gap:10px;row-gap:12px}
.right{margin-left:auto}

input,select,button,textarea{
  font-size:16px;padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:#fff
}
textarea{resize:none}
button{border:none;font-weight:800;cursor:pointer}
button:disabled{opacity:.55;cursor:not-allowed}

.btn-start{background:#16a34a;color:#fff}
.btn-pause{background:#111827;color:#fff}
.btn-stop{background:#dc2626;color:#fff}
.btn-blue{background:var(--primary);color:#fff}
.btn-ghost{background:#eef2f7;color:#0f172a}
.btn-sm{padding:8px 10px;font-size:14px;border-radius:10px}

.tabs{display:flex;gap:8px;flex-wrap:wrap}
.tab{padding:10px 14px;border-radius:12px;background:#eef2f7;cursor:pointer}
.tab.active{background:#111;color:#fff}

.badge{
  display:inline-flex;align-items:center;gap:6px;
  padding:8px 12px;border-radius:999px;
  font-size:12px;font-weight:900;
  background:var(--chip);
  border:1px solid rgba(0,0,0,.06);
  white-space:nowrap;
}
.chip-ok{background:var(--okbg);color:var(--ok)}
.chip-warn{background:var(--warnbg);color:var(--warn)}

table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #eef2f7;font-size:14px;vertical-align:top}
th{text-align:left;color:#64748b}

/* âœ… table wrapper: nix ragt raus */
.table-wrap{overflow-x:auto; -webkit-overflow-scrolling:touch; border-radius:14px}
.table-wrap table{min-width:560px}

/* kompakter auf Handy */
@media(max-width:430px){
  th,td{padding:6px;font-size:13px}
  .table-wrap table{min-width:520px}
}
@media(max-width:360px){
  th,td{padding:5px;font-size:12px}
  .table-wrap table{min-width:500px}
}

/* Felder */
.w-emp{width:220px;max-width:220px}
.w-save{width:170px;max-width:170px}
.w-note{width:150px;max-width:150px}
.w-edit-note{width:200px;max-width:200px;height:44px}

/* âœ… Manager weiter nach links */
.w-mgr-name{width:180px;max-width:180px;margin-left:-10px}
.w-mgr-mail{width:360px;max-width:88vw;min-width:320px;margin-left:-13px}

@media(max-width:360px){
  .w-emp{width:210px;max-width:210px}
  .w-note{width:145px;max-width:145px}
  .w-edit-note{width:190px;max-width:190px}
  .w-mgr-name{width:170px;max-width:170px;margin-left:-10px}
  .w-mgr-mail{min-width:320px;margin-left:-13px}
}

/* âœ… Ãœbersicht Summe zweizeilig */
#sumChip{
  white-space:normal !important;
  line-height:1.25;
  max-width:100%;
  display:block;
}
#overviewControls{ row-gap:16px; }

/* âœ… kompakte Badges (Abwesenheit, WE) */
.small-badge{
  display:inline-flex;align-items:center;gap:4px;
  padding:2px 7px;border-radius:999px;
  font-size:11px;font-weight:800;
  line-height:1.2;
  background:#eef2f7;color:#111827;
  border:1px solid rgba(0,0,0,.10);
  vertical-align:middle; white-space:nowrap;
}
.small-badge .e{font-size:12px;line-height:1}

/* âœ… EintrÃ¤ge: Suche + Badge weiter nach links (weg vom Rand) */
.entries-search-wrap{ margin-left:auto; margin-right:-6px; }
.entries-sum-wrap{ margin-left:auto; margin-right:-6px; }
@media(max-width:420px){
  .entries-search-wrap{ margin-right:-8px; }
  .entries-sum-wrap{ margin-right:-8px; }
}
#entriesSearch{ width:min(340px, 78vw); }

/* âœ… Notiz-Spalte: Badge + Text sauber in einer Zeile */
.note-cell{
  display:flex; align-items:center; gap:6px;
  max-width:260px;
}
.note-text{
  overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
  max-width:200px;
}
@media(max-width:430px){
  .note-cell{max-width:220px}
  .note-text{max-width:160px}
}

/* PIN overlay */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;padding:14px}
.modal{width:min(560px,100%);background:#fff;border-radius:16px;padding:14px;box-shadow:0 12px 40px rgba(0,0,0,.25)}
.modal h2{margin-top:0}
.pin{width:min(360px,86vw);max-width:86vw;letter-spacing:.08em;font-weight:900;text-align:center;font-size:18px;padding:10px 12px}

/* PRINT/PDF */
@media print{
  body{background:#fff;padding:0}
  .card{box-shadow:none;border-radius:0;margin:0 0 12px 0}
  #tabsCard, #timer, #edit, #absence, #entries, #settings, #ovl {display:none !important;}
  #overview{display:block !important;}
  #overviewControls, #btnRefresh, #btnCSV, #btnShare, #btnPDF {display:none !important;}
  #managerBlock {display:none !important;} /* âœ… Manager NICHT im PDF */
  #topHint{display:none !important;}
}
</style>
</head>

<body>

<div class="card" id="appHeader">
  <h1>Zeiterfassung</h1>
  <div class="muted" id="topHint">ğŸ” PIN+Recovery Â· Offline Â· Auto-Pause 55 min Â· ğŸ“Š Ãœbersicht Â· ğŸ–¨ï¸ PDF Â· â¬‡ï¸ CSV</div>
</div>

<div class="card" id="tabsCard">
  <div class="tabs">
    <div class="tab active" data-tab="timer">â±ï¸ Timer</div>
    <div class="tab" data-tab="overview">ğŸ“Š Ãœbersicht</div>
    <div class="tab" data-tab="edit">ğŸ—“ï¸ RÃ¼ckwirkend</div>
    <div class="tab" data-tab="absence">ğŸ–ï¸ Abwesenheit</div>
    <div class="tab" data-tab="entries">ğŸ§¾ EintrÃ¤ge</div>
    <div class="tab" data-tab="settings">âš™ï¸ Settings</div>
  </div>
</div>

<!-- TIMER -->
<div class="card" id="timer">
  <h2>â±ï¸ Timer</h2>

  <div class="row" style="margin-bottom:10px">
    <div class="muted" style="width:100%">ğŸ‘¤ Mitarbeiter</div>
    <input id="empName" class="w-emp" placeholder="Vorname Nachname" />
    <button class="btn-ghost w-save" id="saveName">ğŸ’¾ Speichern</button>
    <span class="right muted mono" id="timerMini"></span>
  </div>
  <div class="muted" id="nameMsg"></div>

  <div class="row" style="margin-top:12px">
    <div>
      <div class="muted">ğŸ“… Datum</div>
      <input type="date" id="timerDate" />
    </div>
    <div>
      <div class="muted">ğŸ“ Notiz <span class="muted">(optional)</span></div>
      <input id="timerNote" class="w-note" placeholder="kurz" />
    </div>
    <span class="right muted mono" id="timerInfo"></span>
  </div>

  <div class="row" style="margin-top:12px">
    <button class="btn-start" id="btnStart">â–¶ï¸ Start</button>
    <button class="btn-pause" id="btnPause" disabled>â¸ï¸ Pause</button>
    <button class="btn-stop" id="btnStop">â¹ï¸ Stop</button>
    <span class="badge" id="timerStatus">âšª bereit</span>
  </div>
</div>

<!-- OVERVIEW -->
<div class="card" id="overview" style="display:none">
  <h2>ğŸ“Š Ãœbersicht</h2>

  <div class="muted" style="margin-top:6px;">ğŸ‘¤ Mitarbeiter: <span id="pdfEmpName">â€”</span></div>
  <div class="muted" style="margin-top:4px;">ğŸ“… Zeitraum: <span id="pdfRangeText">â€”</span></div>
  <div class="muted" style="margin-top:4px;">â±ï¸ IST/SOLL/Î”: <span id="pdfSumText">â€”</span></div>

  <div class="row" id="overviewControls" style="margin-top:12px">
    <div>
      <div class="muted">ğŸ§­ Modus</div>
      <select id="mode">
        <option value="week">ğŸ“† Woche</option>
        <option value="month">ğŸ—“ï¸ Monat</option>
        <option value="year">ğŸ“… Jahr</option>
      </select>
    </div>
    <div>
      <div class="muted">ğŸ“… Datum</div>
      <input type="date" id="refDate" />
    </div>
    <div>
      <div class="muted">ğŸ¯ Wochen-Soll</div>
      <select id="weeklyTarget">
        <option value="2400">40:00 ğŸ‡©ğŸ‡ª</option>
        <option value="2310">38:30 ğŸ‡¦ğŸ‡¹</option>
      </select>
    </div>

    <button class="btn-ghost" id="btnRefresh">ğŸ”„</button>
    <button class="btn-blue" id="btnCSV">â¬‡ï¸ CSV</button>
    <button class="btn-ghost" id="btnShare">ğŸ“¤ Teilen</button>
    <button class="btn-ghost" id="btnPDF">ğŸ–¨ï¸ PDF</button>
    <span class="right muted mono" id="rangeHint"></span>
  </div>

  <div class="row" style="margin-top:12px">
    <span class="badge" id="sumChip">â€”</span>
    <span class="badge" id="weChip" style="display:none">â€”</span>
    <span class="badge right" id="avgChip" style="display:none">â€”</span>
  </div>

  <div id="managerBlock" style="margin-top:14px">
    <h2>ğŸ‘” Manager</h2>
    <div class="row">
      <div class="muted" style="width:100%">Name</div>
      <input id="mgrName" class="w-mgr-name" placeholder="Name" />
      <div class="muted" style="width:100%">E-Mail</div>
      <input id="mgrMail" class="w-mgr-mail" placeholder="vorname.nachname@firma.de" />
      <button class="btn-ghost w-save" id="saveMgr">ğŸ’¾ Speichern</button>
    </div>
  </div>

  <div id="overviewTable" style="margin-top:12px"></div>
</div>

<!-- EDIT -->
<div class="card" id="edit" style="display:none">
  <h2>ğŸ—“ï¸ RÃ¼ckwirkend</h2>
  <div class="row">
    <div><div class="muted">ğŸ“… Datum</div><input type="date" id="eDate" /></div>
    <div><div class="muted">â±ï¸ Start</div><input type="time" id="eStart" /></div>
    <div><div class="muted">â¹ï¸ Ende</div><input type="time" id="eEnd" /></div>
    <div><div class="muted">ğŸ“ Notiz</div><input id="eNote" class="w-edit-note" placeholder="optional" /></div>
  </div>
  <div class="row" style="margin-top:10px">
    <button class="btn-ghost" id="saveManual">ğŸ’¾ Speichern</button>
    <button class="btn-ghost" id="newManual">ğŸ†• Neu</button>
    <span class="right muted mono" id="editMsg"></span>
  </div>
</div>

<!-- ABSENCE -->
<div class="card" id="absence" style="display:none">
  <h2>ğŸ–ï¸ Abwesenheit</h2>
  <div class="muted">ğŸ“† Zeitraum Â· Moâ€“Fr Â· pro Tag max. 1 (ersetzt doppelte automatisch)</div>

  <div class="row" style="margin-top:10px">
    <div><div class="muted">Start</div><input type="date" id="aStart" /></div>
    <div><div class="muted">Ende</div><input type="date" id="aEnd" /></div>
    <div>
      <div class="muted">Typ</div>
      <select id="aType"></select>
    </div>
    <button class="btn-ghost" id="addAbs">ğŸ’¾ Speichern</button>
  </div>

  <div class="row" style="margin-top:12px">
    <div><div class="muted">Einzeltag lÃ¶schen</div><input type="date" id="aDelDate" /></div>
    <button class="btn-ghost" id="delAbsDay">ğŸ—‘ï¸ LÃ¶schen</button>
    <span class="right muted mono" id="absMsg"></span>
  </div>

  <div id="absList" style="margin-top:12px"></div>
</div>

<!-- ENTRIES -->
<div class="card" id="entries" style="display:none">
  <h2>ğŸ§¾ EintrÃ¤ge</h2>

  <div class="row">
    <div>
      <div class="muted">ğŸ§© Filter</div>
      <select id="entriesFilter">
        <option value="week">ğŸ“† Woche</option>
        <option value="month" selected>ğŸ—“ï¸ Monat</option>
        <option value="year">ğŸ“… Jahr</option>
        <option value="custom">ğŸ§· Zeitraum</option>
      </select>
    </div>

    <div id="entriesFromWrap" style="display:none">
      <div class="muted">Von</div>
      <input type="date" id="entriesFrom" />
    </div>

    <div id="entriesToWrap" style="display:none">
      <div class="muted">Bis</div>
      <input type="date" id="entriesTo" />
    </div>

    <div class="entries-search-wrap">
      <div class="muted">ğŸ” Suche (Notiz)</div>
      <input id="entriesSearch" placeholder="z.B. Urlaub / Workshop" />
    </div>
  </div>

  <div class="row" style="margin-top:10px">
    <div class="entries-sum-wrap">
      <span class="badge" id="entriesSum">â€”</span>
    </div>
    <button class="btn-ghost right" id="entriesExportCSV">â¬‡ï¸ CSV</button>
  </div>

  <div id="entryList" style="margin-top:12px"></div>
</div>

<!-- SETTINGS -->
<div class="card" id="settings" style="display:none">
  <h2>âš™ï¸ Settings</h2>
  <div class="muted">ğŸ” Entsperrt bleibt bis Safari geschlossen wird (Session).</div>

  <div class="row" style="margin-top:12px">
    <button class="btn-ghost" id="btnLock">ğŸ”’ Sperren</button>
    <button class="btn-ghost" id="btnChangePin">
